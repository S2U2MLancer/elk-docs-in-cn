# Aggregations

聚合框架提供基于查询结果的聚合. 它基于被称为聚合(aggregations)的一种简单的构建块, 它可以被组合用于构建复杂的数据汇总.

聚合可以被看作是一个工作单元(unit-of-work), 基于一系列文档来构建分析结果.
执行的上下文定义了使用了哪些文档(例如, 顶级的聚合在已执行的查询请求的上下文中执行).

- Bucketing, 一种用于构建桶的聚合, 每个桶都会关联一个key和一个文档要求.
当聚合被执行时, 所有的存储桶条件会和上下文中的每个文档进行匹配, 
如果匹配, 则文档被认为被放入了相关的桶中. 
在聚合结束时, 我们会得到一系列桶, 每个桶会有一系列属于它的文档.
- Metric, 在一组文档中跟踪和计算指标的聚合
- Matrix, 一种基于多个字段计算的聚合, 它会根据请求的文档字段所提取的值生成一个结果矩阵.
不同于Metric以及Bucketing, 它不支持脚本.
- Pipeline, 其他聚合的输出和他们相关指标的聚合.

接下来是有趣的部分。 由于每个存储桶有效地定义了一个文档集（属于该存储桶的所有文档），
因此可以在存储桶级别上关联聚合，并且这些聚合将在该存储桶的上下文中执行。
这就是聚合的真正力量所在：聚合可以嵌套！

分组聚合可以具有子聚合（bucketing或metric）。 
将为其父聚合生成的桶计算子聚合。 
嵌套聚合的级别/深度没有硬性限制（可以在“父”聚合下嵌套聚合，“父”聚合本身是另一个更高级聚合的子聚合）。

## Structuring Aggregations

TODO

## Values Source

TODO
